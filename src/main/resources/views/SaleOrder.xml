<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.0.xsd">



	<form name="ms-sale-order-form-partner" title="Sale order"
		model="com.axelor.apps.sale.db.SaleOrder"
		onNew="action-group-sale-saleorder-onnew,action-group-partner-saleorder-onnew"
		onLoad="action-group-sale-saleorder-onload" width="large">

		<panel-include view="ms-sale-order-form" />
	</form>

	<form id="ms-sale-order-form" name="ms-sale-order-form" title="Sale order" model="com.axelor.apps.sale.db.SaleOrder" width="large" onLoad="action-group-sale-saleorder-onload" onNew="action-group-sale-saleorder-onnew">
	  <menubar>
	    <menu title="Reports">
	      <item title="Print" hideIf="clientPartner == null" action="save,ms-action-sale-order-method-show-sale-order"/>
	      <item title="Print proforma invoice" hideIf="clientPartner == null" action="save,ms-action-sale-order-method-print-proforma-invoice"/>
	      <item title="Excel Export" hideIf="clientPartner == null" action="save,action-sale-order-method-export-sale-order-excel"/>
	      <item title="Word Export" hideIf="clientPartner == null" action="save,action-sale-order-method-export-sale-order-word"/>
	    </menu>
	    <menu title="Tools">
	      <item title="Schedule Event" hideIf="clientPartner == null" action="action-sale-order-view-schedule-event"/>
	      <item title="Send email" hideIf="clientPartner == null" action="save,action-send-by-email-with-template"/>
	      <item title="Define as template" hideIf="clientPartner == null" action="save,action-sale-order-method-generate-template"/>
	    </menu>
	  </menubar>
	  <panel name="main" title="Infos Générales" showIf="$isSimplified">
	    <panel name="actions" title="Actions" hideIf="clientPartner == null" colSpan="12">
	      <panel colSpan="12">
	        <button name="finalize" title="Finalize" showIf="statusSelect == 1" colSpan="3" onClick="save,action-sale-order-method-finalize-quotation"/>
	        <button name="cancel" title="Cancel" showIf="id &amp;&amp; (statusSelect == 1 || statusSelect == 2)" colSpan="3" onClick="save,action-sale-order-view-cancel"/>
	        <button if="(__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain')?.allowCompleteManuallySaleOrder) || (!__config__.app.isApp('supplychain'))" name="completeManuallySaleOrder" title="Complete manually sale order" showIf="statusSelect == 3" colSpan="3" onClick="save,action-sale-order-method-complete-sale-order"/>
	        <button if="__config__.app.getApp('sale').getManageSaleOrderVersion()" name="newVersion" title="New version" showIf="statusSelect == 2" colSpan="3" onClick="save,action-sale-record-newVersion,save"/>
	        <button if="__config__.app.getApp('sale').allowPendingOrderModification" name="editOrder" title="Edit order" showIf="statusSelect == 3 &amp;&amp; !orderBeingEdited" colSpan="3" onClick="action-sale-order-method-edit-order"/>
	        <button name="validateChanges" title="Validate changes" showIf="statusSelect == 3 &amp;&amp; orderBeingEdited" colSpan="3" onClick="action-sale-order-validate-changes,save"/>
	        <button if="__config__.app.getApp('supplychain')?.custStockMoveMgtOnSO &amp;&amp; !__config__.app.getApp('supplychain').customerStockMoveGenerationAuto" name="generateCustomerStockMove" title="Generate customer deliveries" showIf="statusSelect == 3 &amp;&amp; !orderBeingEdited" readonlyIf="!saleOrderLineList || !saleOrderLineList.length" colSpan="3" onClick="save, action-supplychain-sale-order-create-stock-move"/>
	        <button name="confirmOrder" title="Confirm order" showIf="statusSelect == 2" colSpan="3" onClick="save,action-sale-group-confirmed"/>
	        <button if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain').getGenerateInvoiceFromSaleOrder()" if-module="axelor-supplychain" name="generateInvoice" title="Generate invoice" showIf="statusSelect == 3 &amp;&amp; !orderBeingEdited" colSpan="3" onClick="save,action-supplychain-sale-order-view-invoicing-wizard"/>
	        <button if="__config__.app.isApp('supplychain') &amp;&amp; !__config__.app.getApp('supplychain').getPurchaseOrderGenerationAuto()" name="generatePO" title="Generate purchase order" showIf="(statusSelect == 2 || statusSelect == 3) &amp;&amp; !orderBeingEdited" colSpan="3" onClick="save,action-supplychain-sale-order-generate-purchase-orders-from-selected-SOLines"/>
	        <button if="__config__.app.getApp('production')?.prodOrderMgtOnSO &amp;&amp; !__config__.app.getApp('production')?.productionOrderGenerationAuto" name="generateProductionOrder" title="Generate production order" showIf="statusSelect == 3 &amp;&amp; !orderBeingEdited" colSpan="3" onClick="save,action-sale-order-method-create-production-order"/>
	
	
	        <button if="__config__.app.isApp('supplychain') &amp;&amp; !__config__.app.getApp('account').getManageAdvancePaymentInvoice()" if-module="axelor-supplychain" name="addAdvancePayment" title="Register a deposit" showIf="statusSelect == 3 &amp;&amp; amountInvoiced == 0" colSpan="3" onClick="save,action-sale-order-view-register-advance-payment"/>
	        <field name="message" hidden="true" type="string"/>
	        <field name="amountInvoiced" hidden="true"/>
	        <button if="__config__.app.getApp('sale').getEnableConfigurator()" name="addLineFromConfigurator" title="Add Line from Configurator" showIf="statusSelect == 1" onClick="save,action-sale-order-view-generate-line"/>
	      </panel>
	    </panel>
	    <field name="clientPartner" readonlyIf="saleOrderLineList.length > 0 || statusSelect >= 2" colSpan="6" onChange="action-sale-order-group-client-partner-change,action-sale-order-record-compute-end-of-validity-date" onSelect="action-set-client-partner-domain" form-view="partner-form" grid-view="partner-grid"/>
	    <field name="contactPartner" onChange="action-record-so-contact-partner-change" onSelect="action-sale-order-domain-on-contact-partner" domain="self.isContact = true" form-view="partner-contact-form" grid-view="partner-contact-grid" colspan="6"/>
	    <field name="$isSimplified" title="Vue simplifiée" colSpan="12" widget="InlineCheckbox"/>
	  </panel>
	  <panel name="main" title="Infos Générales" showIf="!$isSimplified">
	    <panel name="actions" title="Actions" hideIf="clientPartner == null" colSpan="12">
	      <panel colSpan="12">
	        <button name="finalize" title="Finalize" showIf="statusSelect == 1" colSpan="3" onClick="save,action-sale-order-method-finalize-quotation"/>
	        <button name="cancel" title="Cancel" showIf="id &amp;&amp; (statusSelect == 1 || statusSelect == 2)" colSpan="3" onClick="save,action-sale-order-view-cancel"/>
	        <button if="(__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain')?.allowCompleteManuallySaleOrder) || (!__config__.app.isApp('supplychain'))" name="completeManuallySaleOrder" title="Complete manually sale order" showIf="statusSelect == 3" colSpan="3" onClick="save,action-sale-order-method-complete-sale-order"/>
	        <button if="__config__.app.getApp('sale').getManageSaleOrderVersion()" name="newVersion" title="New version" showIf="statusSelect == 2" colSpan="3" onClick="save,action-sale-record-newVersion,save"/>
	        <button if="__config__.app.getApp('sale').allowPendingOrderModification" name="editOrder" title="Edit order" showIf="statusSelect == 3 &amp;&amp; !orderBeingEdited" colSpan="3" onClick="action-sale-order-method-edit-order"/>
	        <button name="validateChanges" title="Validate changes" showIf="statusSelect == 3 &amp;&amp; orderBeingEdited" colSpan="3" onClick="action-sale-order-validate-changes,save"/>
	        <button if="__config__.app.getApp('supplychain')?.custStockMoveMgtOnSO &amp;&amp; !__config__.app.getApp('supplychain').customerStockMoveGenerationAuto" name="generateCustomerStockMove" title="Generate customer deliveries" showIf="statusSelect == 3 &amp;&amp; !orderBeingEdited" readonlyIf="!saleOrderLineList || !saleOrderLineList.length" colSpan="3" onClick="save, action-supplychain-sale-order-create-stock-move"/>
	        <button name="confirmOrder" title="Confirm order" showIf="statusSelect == 2" colSpan="3" onClick="save,action-sale-group-confirmed"/>
	        <button if="__config__.app.isApp('supplychain') &amp;&amp; __config__.app.getApp('supplychain').getGenerateInvoiceFromSaleOrder()" if-module="axelor-supplychain" name="generateInvoice" title="Generate invoice" showIf="statusSelect == 3 &amp;&amp; !orderBeingEdited" colSpan="3" onClick="save,action-supplychain-sale-order-view-invoicing-wizard"/>
	        <button if="__config__.app.isApp('supplychain') &amp;&amp; !__config__.app.getApp('supplychain').getPurchaseOrderGenerationAuto()" name="generatePO" title="Generate purchase order" showIf="(statusSelect == 2 || statusSelect == 3) &amp;&amp; !orderBeingEdited" colSpan="3" onClick="save,action-supplychain-sale-order-generate-purchase-orders-from-selected-SOLines"/>
	        <button if="__config__.app.getApp('production')?.prodOrderMgtOnSO &amp;&amp; !__config__.app.getApp('production')?.productionOrderGenerationAuto" name="generateProductionOrder" title="Generate production order" showIf="statusSelect == 3 &amp;&amp; !orderBeingEdited" colSpan="3" onClick="save,action-sale-order-method-create-production-order"/>
	
	
	        <button if="__config__.app.isApp('supplychain') &amp;&amp; !__config__.app.getApp('account').getManageAdvancePaymentInvoice()" if-module="axelor-supplychain" name="addAdvancePayment" title="Register a deposit" showIf="statusSelect == 3 &amp;&amp; amountInvoiced == 0" colSpan="3" onClick="save,action-sale-order-view-register-advance-payment"/>
	        <field name="message" hidden="true" type="string"/>
	        <field name="amountInvoiced" hidden="true"/>
	        <button if="__config__.app.getApp('sale').getEnableConfigurator()" name="addLineFromConfigurator" title="Add Line from Configurator" showIf="statusSelect == 1" onClick="save,action-sale-order-view-generate-line"/>
	      </panel>
	    </panel>
	    <panel title="Informations Devis" colSpan="6">
	      <field name="statusSelect" showTitle="false" colSpan="12" widget="NavSelect"/>
	      <field name="saleOrderSeq" title="Numéro" colSpan="3" css="label-bold bold red"/>
	      <field if="__config__.app.getApp('sale').getManageSaleOrderVersion()" name="versionNumber" title="Version" colSpan="3" css="label-bold bold red"/>
	      <field name="currency" readonlyIf="statusSelect >= 2" colSpan="3" canEdit="false" form-view="currency-form" grid-view="currency-grid"/>
	      <field name="company" readonlyIf="statusSelect == 3 || clientPartner != null" colSpan="3" widget="SuggestBox" canEdit="false" onChange="action-sale-group-onchange-company" form-view="company-form" grid-view="company-grid"/>
	      <field name="creationDate" readonlyIf="statusSelect != 1" colSpan="3" onChange="action-sale-order-record-compute-end-of-validity-date"/>
	      <field name="duration" readonlyIf="statusSelect >= 2" colSpan="3" widget="SuggestBox" canNew="true" onChange="action-sale-order-record-compute-end-of-validity-date"/>
	      <field name="endOfValidityDate" readonly="true" colSpan="3">
	        <hilite color="danger" if="$moment().diff(endOfValidityDate, 'days') > 0 &amp;&amp; statusSelect != 3"/>
	      </field>
	      <field name="confirmedByUser" readonly="true" showIf="statusSelect == 3" colSpan="3" canNew="false" canView="false" canEdit="false" form-view="user-form" grid-view="user-grid"/>
	      <field name="confirmationDate" readonly="true" showIf="statusSelect == 3" colSpan="3"/>
	      <field name="orderDate" showIf="statusSelect == 3" colSpan="3"/>
	      <field name="orderNumber" showIf="statusSelect == 3" colSpan="3"/>
	      <field if="__config__.app.isApp('supplychain')" if-module="axelor-supplychain" name="shipmentDate" showIf="statusSelect == 3" colSpan="3"/>      
	      <!--<field if="__config__.app.isApp('supplychain') &amp;&amp; !__config__.app.getApp('supplychain').getAllowTimetableInvoicing()" name="expectedRealisationDate" colSpan="3"/>-->
	      <field name="cancelReason" hidden="true"/>
	      <field name="cancelReasonStr" title="Cancel Reason" hidden="true" readonly="true" showIf="cancelReason != null &amp;&amp; cancelReasonStr != null" colSpan="12" css="red">
	        <viewer><![CDATA[{{record.cancelReasonStr}}]]></viewer>
	      </field>
	      <field if="__config__.app.isApp('supplychain')" if-module="axelor-supplychain" name="standardDelay" hidden="true" readonly="true" showIf="standardDelay > 0"/>
	      <panel name="financialTerms" title="Financial terms" colSpan="12" if-module="axelor-supplychain"  if="__config__.app.isApp('supplychain')">
		        <field name="paymentMode" readonlyIf="statusSelect &gt;= 2" canEdit="false" onChange="action-sale-order-method-fill-company-bank-details" domain="self.inOutSelect = 1"  form-view="payment-mode-form" grid-view="payment-mode-grid"/>
		        <field name="paymentCondition" readonlyIf="statusSelect &gt;= 2" canEdit="false" form-view="payment-condition-form" grid-view="payment-condition-grid"/>
		    </panel>
	    </panel>
	    <panel title="Infos Clients" colSpan="6">
	      <field name="clientPartner" readonlyIf="saleOrderLineList.length > 0 || statusSelect >= 2" colSpan="6" onChange="action-sale-order-group-client-partner-change,action-sale-order-record-compute-end-of-validity-date" onSelect="action-set-client-partner-domain" form-view="partner-form" grid-view="partner-grid"/>
	      <field name="contactPartner" onChange="action-record-so-contact-partner-change" onSelect="action-sale-order-domain-on-contact-partner" domain="self.isContact = true" form-view="partner-contact-form" grid-view="partner-contact-grid" colspan="6"/>
	      <panel stacked="true">
	        <field name="mainInvoicingAddress" hideIf="$readonly() || statusSelect > 1" canNew="true" onChange="action-sale-order-method-address-str" onSelect="action-sale-order-attrs-domain-main-invoicing-address" form-view="address-partner-address-form" grid-view="address-grid"/>
	        <field name="mainInvoicingAddressStr" readonlyIf="statusSelect > 1" height="5">
	          <viewer><![CDATA[{{record.mainInvoicingAddressStr}}]]></viewer>
	        </field>
	      </panel>
	      <panel stacked="true">
	        <field name="deliveryAddress" hideIf="$readonly() || statusSelect > 1" canNew="true" onChange="action-sale-order-method-address-str" onSelect="action-sale-order-attrs-domain-delivery-address" form-view="address-partner-address-form" grid-view="address-grid"/>
	        <field name="deliveryAddressStr" readonlyIf="statusSelect > 1" height="5">
	          <viewer><![CDATA[{{record.deliveryAddressStr}}]]></viewer>
	        </field>
	      </panel>
	      <field name="priceList" readonlyIf="statusSelect >= 2" onChange="action-sale-order-record-hide-discount" onSelect="action-sale-order-method-price-list-domain" form-view="price-list-form" grid-view="price-list-grid"/>
	      <field name="externalReference"/>
	    </panel>
	    <panel colSpan="12" stacked="true">
	      <field name="$isSimplified" title="Vue simplifiée" colSpan="4" widget="InlineCheckbox"/>
	    </panel>
	  </panel>
	  <panel name="detail" id="ms-saleorder-detail">
	    <panel-related readonlyIf="clientPartner == null || statusSelect == 2 || (statusSelect == 3 &amp;&amp; !orderBeingEdited) || statusSelect == 4" colSpan="12" height="100" field="saleOrderLineList" form-view="ms-sale-order-line-form" grid-view="ms-sale-order-line-grid" orderBy="sequence" onChange="action-sale-order-line-change-group" canMove="true"/>
	    <panel title="Margin" readonly="true" hideIf="clientPartner == null" itemSpan="6" sidebar="true">
	      <field name="totalCostPrice"/>
	      <field name="totalGrossMargin"/>
	      <field name="marginRate"/>
	    </panel>
	    <field name="inTaxTotal" showTitle="false" colSpan="6" css="order-subtotal">
	      <viewer depends="exTaxTotal,currency.symbol,taxTotal,statusSelect,amountInvoiced,advanceTotal,exTaxTotalPrimary,exTaxTotalEcoTax"><![CDATA[
	
	                  <dl class="dl-horizontal">
	                      <dt x-translate>Total Brut HT</dt>
	                      <dd>{{record.exTaxTotalPrimary}} {{record.currency.symbol}}</dd>
	                      <dt x-translate>Total EcoTaxe HT</dt>
	                      <dd>{{record.exTaxTotalEcoTax}} {{record.currency.symbol}}</dd>
	                      <dt x-translate>Total NET HT</dt>
	                      <dd>{{record.exTaxTotal}}  {{record.currency.symbol}}</dd>
	                      <dt x-translate>Total tax</dt>
	                      <dd>{{record.taxTotal}}  {{record.currency.symbol}}</dd>
	                      <dt class="order-subtotal-total" x-translate>Total A.T.I.</dt>
	                      <dd class="order-subtotal-total">{{record.inTaxTotal}}  {{record.currency.symbol}}</dd>
	                      <dt ng-show="record.statusSelect >= 3" x-translate>Amount invoiced W.T.</dt>
	                      <dd ng-show="record.statusSelect >= 3">{{record.amountInvoiced}}  {{record.currency.symbol}}</dd>
	                      <dt ng-show="record.statusSelect >= 2" x-translate>Advance payment total</dt>
	                      <dd ng-show="record.statusSelect >= 2">{{record.advanceTotal}}  {{record.currency.symbol}}</dd>
	                  </dl>
	
	              ]]></viewer>
	    </field>
	  </panel>
	  <panel-mail>
	    <mail-messages limit="4"/>
	    <mail-followers/>
	  </panel-mail>
	</form>
	
	<action-method name="ms-action-sale-order-method-show-sale-order">
		<call class="com.axelor.apps.misyl.custom.web.MisylSaleOrderController"
			method="showSaleOrder" />
	</action-method>
	<action-method name="ms-action-sale-order-method-print-proforma-invoice">
		<call class="com.axelor.apps.misyl.custom.web.MisylSaleOrderController"
			method="printProformaInvoice" />
	</action-method>

</object-views>